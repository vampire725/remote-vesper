# Logstash éƒ¨ç½²æ–¹æ¡ˆ

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªä¸åŒçš„ Logstash éƒ¨ç½²æ–¹æ¡ˆï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œå®‰å…¨è¦æ±‚ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
logstash/
â”œâ”€â”€ simple/              # ç®€å•éƒ¨ç½²ç‰ˆæœ¬
â”‚   â”œâ”€â”€ docker-compose.yaml
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ logstash.yml
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â””â”€â”€ main.conf
â”‚   â”œâ”€â”€ start.sh
â”‚   â”œâ”€â”€ start.bat
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ with-auth/           # ä¼ä¸šçº§è®¤è¯ç‰ˆæœ¬
â”‚   â”œâ”€â”€ docker-compose.yaml
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ logstash.yml
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â””â”€â”€ main.conf
â”‚   â”œâ”€â”€ certs/           # SSLè¯ä¹¦ç›®å½•
â”‚   â”œâ”€â”€ env-template.txt
â”‚   â”œâ”€â”€ start.sh
â”‚   â”œâ”€â”€ start.bat
â”‚   â””â”€â”€ README.md
â””â”€â”€ README.md           # æœ¬æ–‡ä»¶
```

## ğŸš€ éƒ¨ç½²ç‰ˆæœ¬å¯¹æ¯”

### Simple ç‰ˆæœ¬ - å¼€å‘æµ‹è¯•ç¯å¢ƒ

**é€‚ç”¨åœºæ™¯:**

- å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- å¿«é€ŸåŸå‹éªŒè¯
- å­¦ä¹ å’Œå®éªŒ
- å†…ç½‘ç¯å¢ƒéƒ¨ç½²

**ç‰¹æ€§:**

- âœ… å¿«é€Ÿå¯åŠ¨ï¼Œæ— éœ€å¤æ‚é…ç½®
- âœ… æ”¯æŒå¤šç§è¾“å…¥æºï¼ˆBeatsã€TCPã€UDPã€HTTPï¼‰
- âœ… åŸºç¡€çš„æ—¥å¿—å¤„ç†å’Œè¿‡æ»¤
- âœ… è¾“å‡ºåˆ°å¤–éƒ¨ Elasticsearch
- âŒ æ—  SSL/TLS åŠ å¯†
- âŒ æ— ç”¨æˆ·è®¤è¯
- âŒ æ— é«˜çº§å®‰å…¨åŠŸèƒ½

**èµ„æºè¦æ±‚:**

- å†…å­˜: 2GB+
- CPU: 1 æ ¸å¿ƒ+
- å­˜å‚¨: 10GB+

### With-Auth ç‰ˆæœ¬ - ä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒ

**é€‚ç”¨åœºæ™¯:**

- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ä¼ä¸šçº§åº”ç”¨
- å®‰å…¨åˆè§„è¦æ±‚
- å¤šç§Ÿæˆ·ç¯å¢ƒ

**ç‰¹æ€§:**

- âœ… å®Œæ•´çš„ SSL/TLS åŠ å¯†
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… X-Pack ç›‘æ§é›†æˆ
- âœ… å®‰å…¨äº‹ä»¶æ£€æµ‹
- âœ… å®¡è®¡æ—¥å¿—è®°å½•
- âœ… è¯ä¹¦è‡ªåŠ¨ç®¡ç†
- âœ… é«˜çº§è¿‡æ»¤å’Œå¤„ç†
- âœ… å†…ç½®å®Œæ•´ ELK æ ˆ

**èµ„æºè¦æ±‚:**

- å†…å­˜: 8GB+
- CPU: 2 æ ¸å¿ƒ+
- å­˜å‚¨: 50GB+

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½               | Simple ç‰ˆæœ¬ | With-Auth ç‰ˆæœ¬ |
| ------------------ | ----------- | -------------- |
| **åŸºç¡€åŠŸèƒ½**       |
| Beats è¾“å…¥         | âœ…          | âœ…             |
| TCP/UDP è¾“å…¥       | âœ…          | âœ…             |
| HTTP è¾“å…¥          | âœ…          | âœ…             |
| JSON è§£æ          | âœ…          | âœ…             |
| Grok è§£æ          | âœ…          | âœ…             |
| Elasticsearch è¾“å‡º | âœ…          | âœ…             |
| **å®‰å…¨åŠŸèƒ½**       |
| SSL/TLS åŠ å¯†       | âŒ          | âœ…             |
| ç”¨æˆ·è®¤è¯           | âŒ          | âœ…             |
| è¯ä¹¦ç®¡ç†           | âŒ          | âœ…             |
| å®¢æˆ·ç«¯è®¤è¯         | âŒ          | âœ…             |
| **ç›‘æ§åŠŸèƒ½**       |
| åŸºç¡€ç›‘æ§           | âœ…          | âœ…             |
| X-Pack ç›‘æ§        | âŒ          | âœ…             |
| æ€§èƒ½æŒ‡æ ‡           | âœ…          | âœ…             |
| å¥åº·æ£€æŸ¥           | âœ…          | âœ…             |
| **é«˜çº§åŠŸèƒ½**       |
| åœ°ç†ä½ç½®è§£æ       | âœ…          | âœ…             |
| ç”¨æˆ·ä»£ç†è§£æ       | âœ…          | âœ…             |
| å®‰å…¨äº‹ä»¶æ£€æµ‹       | âŒ          | âœ…             |
| æ•°æ®è„±æ•           | âŒ          | âœ…             |
| å¤šç®¡é“æ”¯æŒ         | âŒ          | âœ…             |
| æŒä¹…åŒ–é˜Ÿåˆ—         | âŒ          | âœ…             |
| **é›†æˆæœåŠ¡**       |
| Elasticsearch      | å¤–éƒ¨        | å†…ç½®           |
| Kibana             | å¤–éƒ¨        | å†…ç½®           |
| è¯ä¹¦æœåŠ¡           | âŒ          | å†…ç½®           |

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### é€‰æ‹©éƒ¨ç½²ç‰ˆæœ¬

**å¦‚æœæ‚¨éœ€è¦:**

- å¿«é€Ÿæµ‹è¯•å’Œå¼€å‘ â†’ é€‰æ‹© `simple` ç‰ˆæœ¬
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² â†’ é€‰æ‹© `with-auth` ç‰ˆæœ¬
- å®‰å…¨åˆè§„è¦æ±‚ â†’ é€‰æ‹© `with-auth` ç‰ˆæœ¬
- å­¦ä¹ å’Œå®éªŒ â†’ é€‰æ‹© `simple` ç‰ˆæœ¬

### éƒ¨ç½²æ­¥éª¤

#### Simple ç‰ˆæœ¬éƒ¨ç½²

```bash
# è¿›å…¥ simple ç›®å½•
cd simple/

# Linux/macOS
chmod +x start.sh
./start.sh start

# Windows
start.bat start
```

#### With-Auth ç‰ˆæœ¬éƒ¨ç½²

```bash
# è¿›å…¥ with-auth ç›®å½•
cd with-auth/

# é…ç½®ç¯å¢ƒå˜é‡
cp env-template.txt .env
nano .env  # è®¾ç½®å¯†ç 

# Linux/macOS
chmod +x start.sh
./start.sh start

# Windows
start.bat start
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç«¯å£ä½¿ç”¨

| ç«¯å£ | Simple ç‰ˆæœ¬  | With-Auth ç‰ˆæœ¬ | è¯´æ˜           |
| ---- | ------------ | -------------- | -------------- |
| 5044 | Beats (HTTP) | Beats (SSL)    | Beats è¾“å…¥ç«¯å£ |
| 9600 | API (HTTP)   | API (HTTPS)    | Logstash API   |
| 5000 | TCP          | TCP (SSL)      | TCP è¾“å…¥       |
| 5001 | UDP          | UDP            | UDP è¾“å…¥       |
| 8080 | HTTP         | HTTPS          | HTTP è¾“å…¥      |
| 9200 | -            | HTTPS          | Elasticsearch  |
| 5601 | -            | HTTPS          | Kibana         |

### ç½‘ç»œé…ç½®

**Simple ç‰ˆæœ¬:**

- ä½¿ç”¨å¤–éƒ¨ `logging-network` ç½‘ç»œ
- éœ€è¦å¤–éƒ¨ Elasticsearch æœåŠ¡
- è½»é‡çº§éƒ¨ç½²ï¼Œèµ„æºå ç”¨å°‘

**With-Auth ç‰ˆæœ¬:**

- ä½¿ç”¨å†…éƒ¨ `elastic-auth-network` ç½‘ç»œ
- åŒ…å«å®Œæ•´çš„ ELK æ ˆ
- è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç† SSL è¯ä¹¦

## ğŸ“ˆ æ€§èƒ½è°ƒä¼˜

### Simple ç‰ˆæœ¬ä¼˜åŒ–

```yaml
# è°ƒæ•´ JVM å†…å­˜
environment:
  - LS_JAVA_OPTS=-Xmx1g -Xms1g

# è°ƒæ•´ç®¡é“é…ç½®
pipeline.workers: 2
pipeline.batch.size: 125
```

### With-Auth ç‰ˆæœ¬ä¼˜åŒ–

```yaml
# è°ƒæ•´ JVM å†…å­˜
environment:
  - LS_JAVA_OPTS=-Xmx4g -Xms4g
  - ES_JAVA_OPTS=-Xmx2g -Xms2g

# è°ƒæ•´ç®¡é“é…ç½®
pipeline.workers: 8
pipeline.batch.size: 500
queue.max_bytes: 4gb
```

## ğŸ”„ ç‰ˆæœ¬è¿ç§»

### ä» Simple è¿ç§»åˆ° With-Auth

1. **å¤‡ä»½é…ç½®**

   ```bash
   # å¤‡ä»½ simple ç‰ˆæœ¬é…ç½®
   cp -r simple/pipeline/ with-auth/pipeline_backup/
   ```

2. **é…ç½®è®¤è¯**

   ```bash
   cd with-auth/
   cp env-template.txt .env
   # ç¼–è¾‘ .env è®¾ç½®å¯†ç 
   ```

3. **å¯åŠ¨æ–°ç‰ˆæœ¬**
   ```bash
   ./start.sh start
   ```

### ä» With-Auth é™çº§åˆ° Simple

1. **å¯¼å‡ºæ•°æ®**

   ```bash
   # ä» Elasticsearch å¯¼å‡ºæ•°æ®
   curl -X GET "localhost:9200/_search" > data_backup.json
   ```

2. **æå–ç®¡é“é…ç½®**

   ```bash
   # å¤åˆ¶ç®¡é“é…ç½®ï¼ˆç§»é™¤ SSL ç›¸å…³é…ç½®ï¼‰
   cp with-auth/pipeline/main.conf simple/pipeline/
   ```

3. **å¯åŠ¨ Simple ç‰ˆæœ¬**
   ```bash
   cd simple/
   ./start.sh start
   ```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**

   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :5044

   # ä¿®æ”¹ç«¯å£æ˜ å°„
   # ç¼–è¾‘ docker-compose.yaml
   ```

2. **å†…å­˜ä¸è¶³**

   ```bash
   # è°ƒæ•´å†…å­˜é™åˆ¶
   # ç¼–è¾‘ docker-compose.yaml ä¸­çš„ JVM å‚æ•°
   ```

3. **ç½‘ç»œè¿æ¥é—®é¢˜**

   ```bash
   # æ£€æŸ¥ç½‘ç»œ
   docker network ls
   docker network inspect logging-network
   ```

4. **SSL è¯ä¹¦é—®é¢˜** (ä»… With-Auth)
   ```bash
   # é‡æ–°ç”Ÿæˆè¯ä¹¦
   cd with-auth/
   ./start.sh certs
   ```

### æ—¥å¿—åˆ†æ

```bash
# Simple ç‰ˆæœ¬
cd simple/
./start.sh logs

# With-Auth ç‰ˆæœ¬
cd with-auth/
./start.sh logs logstash
./start.sh logs elasticsearch
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Simple ç‰ˆæœ¬è¯¦ç»†æ–‡æ¡£](simple/README.md)
- [With-Auth ç‰ˆæœ¬è¯¦ç»†æ–‡æ¡£](with-auth/README.md)
- [Logstash å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/logstash/current/index.html)
- [Elasticsearch æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html)
- [Kibana æ–‡æ¡£](https://www.elastic.co/guide/en/kibana/current/index.html)

## ğŸ¤ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. ä½¿ç”¨ Simple ç‰ˆæœ¬è¿›è¡Œå¿«é€Ÿå¼€å‘
2. å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
3. ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®
4. ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

### ç”Ÿäº§ç¯å¢ƒ

1. ä½¿ç”¨ With-Auth ç‰ˆæœ¬ç¡®ä¿å®‰å…¨
2. å®šæœŸæ›´æ–°é•œåƒç‰ˆæœ¬
3. å®æ–½å®Œæ•´çš„å¤‡ä»½ç­–ç•¥
4. é…ç½®ç›‘æ§å’Œå‘Šè­¦
5. å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡
6. éµå¾ªæœ€å°æƒé™åŸåˆ™

### è¿ç§»å»ºè®®

1. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®
2. åˆ¶å®šè¯¦ç»†çš„è¿ç§»è®¡åˆ’
3. å‡†å¤‡å›æ»šæ–¹æ¡ˆ
4. è¿›è¡Œå……åˆ†çš„æµ‹è¯•
5. ç›‘æ§è¿ç§»åçš„æ€§èƒ½

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç‰ˆæœ¬é€‰æ‹©**: æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬
2. **èµ„æºè§„åˆ’**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç³»ç»Ÿèµ„æº
3. **å®‰å…¨è€ƒè™‘**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ With-Auth ç‰ˆæœ¬
4. **å¤‡ä»½ç­–ç•¥**: å®šæœŸå¤‡ä»½æ•°æ®å’Œé…ç½®
5. **ç›‘æ§å‘Šè­¦**: é…ç½®é€‚å½“çš„ç›‘æ§æœºåˆ¶
6. **æ–‡æ¡£ç»´æŠ¤**: ä¿æŒéƒ¨ç½²æ–‡æ¡£çš„æ›´æ–°

## ğŸ” ç‰ˆæœ¬ç‰¹ç‚¹æ€»ç»“

### Simple ç‰ˆæœ¬

- **ä¼˜ç‚¹**: éƒ¨ç½²ç®€å•ã€èµ„æºå ç”¨å°‘ã€é€‚åˆå¼€å‘æµ‹è¯•
- **ç¼ºç‚¹**: æ— å®‰å…¨åŠŸèƒ½ã€ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- **æ¨èåœºæ™¯**: å¼€å‘ã€æµ‹è¯•ã€å­¦ä¹ ã€å†…ç½‘ç¯å¢ƒ

### With-Auth ç‰ˆæœ¬

- **ä¼˜ç‚¹**: å®‰å…¨å®Œæ•´ã€åŠŸèƒ½ä¸°å¯Œã€é€‚åˆç”Ÿäº§ç¯å¢ƒ
- **ç¼ºç‚¹**: é…ç½®å¤æ‚ã€èµ„æºå ç”¨å¤š
- **æ¨èåœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€ä¼ä¸šåº”ç”¨ã€å®‰å…¨åˆè§„

é€‰æ‹©é€‚åˆæ‚¨éœ€æ±‚çš„ç‰ˆæœ¬ï¼Œå¹¶å‚è€ƒç›¸åº”çš„è¯¦ç»†æ–‡æ¡£è¿›è¡Œéƒ¨ç½²å’Œé…ç½®ã€‚
